#!/bin/bash
# Repo script to setup rhel-7 with osp10

set -eux

REG_REPOS="rhel-7-server-rpms rhel-7-server-extras-rpms rhel-7-server-rh-common-rpms rhel-ha-for-rhel-7-server-rpms rhel-7-server-openstack-10-rpms rhel-7-server-rhceph-2-osd-rpms rhel-7-server-rhceph-2-mon-rpms" # repos to enable for image build

subscription-manager register --username {{ rhel_reg_user }} --password {{ rhel_reg_password }} --force 

# attach the desired pool id
subscription-manager attach --pool={{ rhel_reg_pool_id }}

# disable all repos by default
yum-config-manager --disable \*
subscription-manager repos --disable=*

repos=""
for repo in $(echo $REG_REPOS | tr ',' '\n'); do
    repos="$repos --enable $repo"
done
subscription-manager repos $repos


# install epel release
sudo yum -y install wget
wget https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm -O /tmp/epel-release-latest-7.noarch.rpm
sudo yum localinstall -y /tmp/epel-release-latest-7.noarch.rpm

# update to get all packages available
sudo yum update -y
